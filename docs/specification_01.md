# 施設予約アプリ 仕様書（ホーム画面中心）

## 1. 前提・思想

本アプリは **「スペース（施設）」を主語**とする予約管理アプリである。

- スペースは以下を含む抽象概念とする
  - 会議室
  - スタジオ
  - ホール
  - 多目的室 など
- ユーザーの関心は以下の順で強い
  1. 今使える（空いている）スペースはどこか
  2. 自分が予約している予定は何か
  3. これから予約を入れられるか
- ホーム画面では **空き状況の把握と予約行動を最短距離**で行えることを最優先とする

---

## 2. データモデル（再掲）

- users
- spaces
- events
- event_participations

### 関係
- space has_many events
- event belongs_to space
- event has_many event_participations
- user has_many event_participations
- user has_many events（主催）

---

## 3. ホーム画面の役割

ログイン後のホーム画面では以下を提供する：

1. **現在・直近のスペースの空き状況**
2. **本日のイベント**
3. **自分の予約一覧**
4. **新規予約（イベント作成）への即時導線**

---

## 4. ホーム画面 UI 構成

### 4.1 ヘッダー

- アプリ名 / ロゴ
- 日付選択（今日 / 明日 / カレンダー）
- 「＋予約する」ボタン（最重要CTA）
- ユーザーメニュー（プロフィール / ログアウト）

---

### 4.2 メインエリア（2カラム構成）

#### 左カラム：スペース（spaces）一覧（主役）

##### 表示内容
- スペース名
- 現在の状態
  - 空き
  - 使用中（〜HH:MMまで）
  - 予約あり（次の予定 HH:MM〜）
- 定員（任意）

##### 操作
- 空き状態の場合：
  - 「このスペースを予約」ボタンを表示
- 使用中 / 予約あり：
  - 次の空き時間を表示
  - 「この時間以降で予約」ボタン

##### 表示ルール
- デフォルトは **現在時刻 기준で空いているスペースを上位表示**
- 使用中のスペースはグレーアウト

---

### 右カラム：日表示スケジュール（バーティカル）

#### 目的
- 選択中の日付における **全イベント**を時系列で可視化する
- その中で **自分が参加するイベント**が一目で分かるようにする
- タイムラインから予約（作成）や詳細確認に遷移できるようにする

#### 表示単位
- 日付：ヘッダーの日付選択と連動（例：2026-02-11）
- 時間軸：営業時間 or 0:00〜24:00
  - 施設運用を想定し、デフォルトは「営業時間」に寄せる（例：08:00〜22:00）
  - 30分スロットを基本とする（UIは15/30/60分で切替可能）

#### 表示内容（タイムライン）
- 縦軸に時間、横幅にイベントブロックを配置
- イベントブロックに表示する情報：
  - 開始〜終了（例：10:00-11:30）
  - タイトル（利用名 / イベント名）
  - スペース名（＋種別は任意）
  - 主催者（任意）
  - 自分の参加状態（後述）

#### 自分が参加するイベントの強調ルール
- event_participations により「参加中」のイベントを判定する
  - 参加判定：`event_participations.user_id = current_user.id` が存在する
  - 併せて「主催者（events.user_id = current_user.id）」も自分関与として扱う
- 表示上の区別（例）
  - **自分が参加/主催しているイベント**：強調表示（枠/バッジ/太字など）
  - **自分が関与していないイベント**：通常表示（薄め）
  - 予約不可の補助情報として「埋まっている時間帯」が分かればよいので、最小情報表示でもよい

#### 競合（同時刻イベント）の扱い
- 同一時刻に複数イベントが存在する場合：
  - 右カラム内で横並びレーンを増やして表示する
  - 横幅が足りない場合：
    - 「+N件」集約表示 → クリックでその時間帯のリスト表示（ポップオーバー/モーダル）

#### 操作（右カラムからできること）
- イベントブロックをクリック → イベント詳細へ
- 空白の時間帯をクリック/ドラッグ → 「新規予約」開始
  - クリック：デフォルト60分で作成フォームへ
  - ドラッグ：選択範囲（開始/終了）を初期値として作成フォームへ
- フィルタ（任意）
  - 「すべて」
  - 「自分が参加するものだけ」
  - 「スペース種別（会議室/スタジオ/ホール）」で絞り込み

#### 表示対象イベントの範囲
- 選択日（00:00〜24:00）に開始または跨って存在するイベントを表示
  - `starts_at < day_end AND ends_at > day_start` を満たすイベント

---

## 5. 日付・時間切り替え仕様（追記）

- 日付切り替えで以下が連動して変化する：
  - 左カラム：スペースの空き状況（選択日内の予約状況から算出）
  - 右カラム：日表示タイムライン（選択日内イベントを表示）
- 右カラムの表示時間帯は設定可能：
  - 営業時間（推奨）または 0:00〜24:00

---

## 6. 新規予約（イベント作成）フロー（追記）

### 6.1 ホームからの導線
- 方法A：ヘッダーの「＋予約する」
- 方法B：左カラムのスペースカード「このスペースを予約」
- 方法C：右カラムのタイムライン空白クリック/ドラッグ（開始・終了を初期値にする）

---

### 6.2 イベント作成画面

#### 入力項目
- スペース（space）
- 開始日時
- 終了日時
- タイトル（利用名 / イベント名）
- 説明（任意）
- 参加者（任意）

#### バリデーション
- 同一スペース・同時間帯に既存eventがある場合は作成不可
- 開始 < 終了
- 過去日時不可

---

## 7. イベント詳細画面

### 表示内容
- スペース名
- 日時
- タイトル
- 説明
- 参加者一覧

### 操作権限
- 主催者：
  - 編集
  - 削除
- 非主催者：
  - 参加 / 参加キャンセル

---

## 8. 権限・振る舞いルール

- イベントは全ユーザー作成可能
- 他人のイベントの編集・削除は不可

---

## 9. 非機能要件（最低限）

- ホーム画面表示は高速であること
  - 日付指定 + space一覧 + eventsをまとめて取得
- モバイル表示では：
  - 上：日付 + CTA
  - 下：スペース一覧 → 自分の予約（縦並び）

---

## 10. 今後の拡張余地

- スペース種別の追加
  - 会議室 / スタジオ / ホール / etc
- スペース種別ごとの利用ルール（最低利用時間・料金）
- 設備・属性アイコン（例：防音 / 鏡 / ピアノ / プロジェクター）
- スペース（施設）の作成・編集機能
- 定期予約
- 承認フロー（仮押さえ → 承認）
- 利用ログ・稼働率可視化
- チェックイン / チェックアウト
- 外部カレンダー連携（Google Calendar 等）

---

## 11. まとめ

- **「スペース（施設）」を主語にした設計**
- ホーム画面 = 施設の空き状況ダッシュボード
- 予約可能かどうかが一目で分かるUIを最優先とする
